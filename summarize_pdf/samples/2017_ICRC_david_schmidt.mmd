# AugerPrime implementation in the Offline simulation and reconstruction framework

David Schmidt\({}^{ab}\) for the Pierre Auger Collaboration\({}^{c}\)

Karlsruhe Institute of Technology (KIT), Institut fur Kernphysik, Karlsruhe, Germany

\({}^{b}\)Instituto de Tecnologias en Deteccion y Astroparticulas, Buenos Aires, Argentina

\({}^{c}\)Observatorio Pierre Auger, Av. San Martin Norte 304, 5613 Malargue, Argentina

E-mail:

Paereere Auger Observatory is in the process of upgrading its surface detector array by placing a 3.84 m\({}^{2}\) scintillator atop each of the existing 1660 water-Cherenkov detectors. The differing responses of the two detectors allow for the disentanglement of the muonic and electromagnetic components of air showers, which ultimately facilitates reconstruction of the mass composition of ultrahigh-energy cosmic rays on an event-by-event basis. Simulations of the scintillator surface detector enable both an assessment of proposed reconstruction algorithms and the interpretation of real shower measurements. The design and implementation of these simulations within a Geant4-based module inside Auger's software framework (Offline) are discussed in addition to the tuning of these simulations to prototype-detector measurements performed using a muon telescope. Augmentations of the Offline framework in order to accommodate a large-scale detector upgrade are also summarized.

## 1 Introduction

The primary objective of the AugerPrime upgrade [1] is to install the additional detector hardware necessary to estimate the composition of ultrahigh-energy cosmic rays on an event-by-event basis. The aim is to provide measurements allowing for the separation of signal contributions from the muonic and electromagnetic shower components at Earth's surface. A better handle on the magnitude of the electromagnetic signal will enhance the precision and accuracy in reconstructing primary energies, whereas the more directly measurable observable of the number of muons reaching the ground will allow for an estimation of the primary mass. The auxiliary detector technology chosen to provide the necessary measurements is the scintillator, of which one will be placed on top of each water-Cherenkov detector in the 3000 km\({}^{2}\) array. Multiple reconstruction algorithms capitalizing on the differing responses of the two types of detectors have demonstrated their joint capacity to disentangle shower components. Detector simulations are necessary in assessing and providing the parameterizations for such algorithms in addition to interpreting the real measurements. Such simulations have been implemented in the \(\overline{\mathrm{Offline}}\) simulation and reconstruction framework [2], which has also been adapted and outfitted with new machinery necessary in accommodating a large-scale detector upgrade.

A surface scintillator detector (SSD) consists of 48 plastic scintillator bars distributed between two symmetric modules covering a combined area of 3.84 m\({}^{2}\). The two modules are housed within a common polystyrene casing, which in turn is encapsulated within an aluminum box. Wavelength-shifting optical fibers route photons from the scintillator bars to a 1.5 inch Hamamatsu R9420 PMT situated between the two modules. For a schematic representation of the SSD design, see Figure 0(a).

## 2 Simulations

At the core of the SSD simulations lies the use of real detector measurements and parameterizations obtained therefrom where possible. Where measurements of a desired quantity are not possible or can not be obtained, for instance the energy deposit of crossing particles during simulation, the latest version of the field-standard simulation software, Geant4 [3] has been employed.

### Detector construction and particle injection

Auger's \(\overline{\mathrm{Offline}}\) development team has upgraded the software to incorporate the latest release from the Geant4 collaboration, version 4.10. The volumes for the SSD are constructed according to the latest geometry and material properties of the engineering array detector design [4]. The scintillator bars are constructed of polystyrene volumes, which are situated within a larger polystyrene casing housed inside an aluminum box. Precise specification of non-sensitive volumes, which act as shielding, is important as they can influence the signal by, for example, changing the rate of electron absorption and gamma conversion above and below the scintillator bars. The scintillator position relative to the water-Cherenkov detector is also of vital importance as many of the same particles traverse and deposit energy in both detectors, which manifests in correlations in signal, the strength of which must be well reproduced. A visualization of the SSD volumes above the water-Cherenkov detector volumes may be observed in Figure 0(b).

Particles resampled [5] from CORSIKA [6] ground particle files are injected onto a virtual cylinder that houses both the water-Cherenkov and scintillator detectors that comprise a surface detector station. In the injection procedure, the momenta of resampled particles are preserved and the entry position of each particle is randomized in such a way that reflects the true probability distribution of intersecting the virtual cylinder at different points on its surface.

### Photoelectrons

Whenever a particle track crosses the scintillator bar volumes in Geant4, the amount of energy deposited in the scintillator is extracted. The expected number of photoelectrons \(\bar{N}(\mathbf{x})\) produced at the PMT's photocathode is then calculated via

\[\bar{N}(\mathbf{x})=N_{\mathrm{ref}}\frac{E_{\mathrm{dep}}}{E_{\mathrm{ref}} }f_{\mathrm{att}}(\mathbf{x}) \tag{1}\]

in which \(E_{\mathrm{dep}}\) is the energy deposit, \(E_{\mathrm{ref}}\) and \(N_{\mathrm{ref}}\) are the respective reference energy and photoelectron numbers for the simulations, \(f_{\mathrm{att}}(\mathbf{x})\) is a function which describes position-dependent signal attenuation, and \(\mathbf{x}\) is the position of the crossing particle. \(E_{\mathrm{ref}}\) was obtained by simulating a sample of one hundred thousand 10 GeV vertical muons with randomized positions across the surface of the scintillator bars. The distribution of deposited energy, as shown in Figure 1(a), has a peak at 1.72 MeV. This peak energy deposit corresponds to the peak in the distribution of vertical-equivalent photoelectron numbers as determined by an analysis of measurements of scintillator modules performed using a muon telescope taken from the former KASCADE experiment [7]. \(f_{\mathrm{att}}(\mathbf{x})\) was obtained from an analysis of the same muon telescope measurement setup, which provided a resolution on the positions of particles crossing the scintillator to the order of a couple of centimeters. The dependence of measured charge on the the position of the crossing particle may be be described by

\[\bar{f}_{\mathrm{att}}(\mathbf{x})=A(\mathbf{x})L(\mathbf{x})\, \tag{2}\]

where \(A(\mathbf{x})\) corresponds to the attenuation of photons along the fiber and is defined as

\[A(\mathbf{x})=e^{-\ell_{\mathrm{c}}(\mathbf{x})/\lambda_{\mathrm{f}}}+e^{- \ell_{\mathrm{f}}(\mathbf{x})/\lambda_{\mathrm{f}}}\, \tag{3}\]

which includes two summed exponential terms corresponding to the fact that photons may travel in either direction and still reach the PMT given the looped fiber layout schematically depicted in

Figure 1: (a) Schematic of a surface scintillator detector, which is comprised of two symmetric modules consisting of 24 plastic scintillator bars each for a combined area of \(3.84\,\mathrm{m}^{2}\). (b) Visualization of scintillator and water-Cherenkov detector volumes as implemented in Geant4 within the \(\overline{\mathrm{Offline}}\) framework.

Figure 3. \(\ell_{\rm c}({\bf x})\) and \(\ell_{\rm f}({\bf x})\) correspond to the two possible distances photons must travel along the fibers from the point of particle intersection to the PMT. \(\lambda_{\rm f}\) corresponds to the attenuation length of the fiber. The term \(L({\bf x})\) in Equation (2) is a factor accounting for the decreased yield for particle tracks very close to the edge of the scintillator bars, namely

\[L({\bf x})=(1-\alpha e^{-d_{\rm c}({\bf x})/\lambda_{\rm b}})(1-\alpha e^{-d_{ \rm f}({\bf x})/\lambda_{\rm b}})\, \tag{4}\]

where \(\alpha\) corresponds to the maximum loss, \(\lambda_{\rm b}\) corresponds to the effective attenuation length of this boundary effect, and \(d_{\rm c}({\bf x})\) and \(d_{\rm f}({\bf x})\) respectively correspond to the distance between the particle crossing point and the close and far ends of the scintillator bars.

The reference number of photoelectrons \(N_{\rm ref}\) from Equation (1) is acquired by mandating that the peak in the distribution of the number of photoelectrons produced by vertical minimum ionizing particles across the surface of the scintillator equals the estimate of 30 (denoted as \(N_{\rm PE}/\rm VMIP\) in Equation (6)) obtained from an independent analysis of muon telescope data [4]. This mandate is fulfilled by integrating \(f_{\rm att}\) only along the portion of the fiber between the ends of the scintillator bars, namely

\[\bar{f}_{\rm att}=\frac{1}{p_{\rm f}-p_{\rm c}}\int_{p_{\rm c}}^{p_{\rm f}}f_ {\rm att}(\ell)\,{\rm d}\ell, \tag{5}\]

where \(p_{\rm c}\) and \(p_{\rm f}\) respectively correspond to ends of the bars with shorter and longer travel distances along the fiber to the PMT. The quoted photoelectron count is then divided by the result to obtain \(N_{\rm ref}\),

\[N_{\rm ref}=\frac{N_{\rm PE}/\rm VMIP}{\bar{f}_{\rm att}}. \tag{6}\]

In the actual simulation code, the expected number of photoelectrons is calculated for each individual leg of the signal using an equivalent formulation of Equation (2). A Poisson randomization

Figure 2: (a) Distribution of energy deposited by one hundred thousand simulated, vertical 10 GeV muons. The peak of the distribution is \(E_{\rm ref}=1.72\) MeV. (b) Distribution of charge measured by a surface scintillator detector triggered using a muon telescope from the KASCADE experiment [7]. Peaks corresponding to single photoelectrons and minimum ionizing particles are visible.

is then performed on each expectation to obtain the true number of photoelectrons arriving from each leg at the PMT. The results of a set simulations may be observed in Figure 3(a) alongside the fit of \(f_{\text{att}}(\mathbf{x})\) to muon telescope measurements. The mean number of photoelectrons observed here is greater than the peak value used for tuning due to the asymmetry in the distribution of energy deposit depicted in Figure 1(a), which may also be observed in the charge distribution from muon telescope measurements shown in Figure 1(b).

Once the number of photoelectrons has been determined, their production times at the photo-cathode must be simulated. The distribution of arrival times for photons having traveled nearly the same length of fiber before reaching the PMT was examined using muon telescope measurements. Although the true decay schema is likely considerably more complex, a model of two sequential exponential decays was found to provide a reasonable description of the data as shown in Figure 3(b).

The decay constants from the fit are used to define two decay time distributions, which are randomly sampled for each photoelectron. Each photoelectron's arrival time is then determined by summing the time at which the particle crossed the scintillator bar, the time photons needed to travel from the crossing point to the fiber, and the two decay times. The time delay due to travel along the fiber is calculated using an effective index of refraction also obtained from muon telescope measurements.

### Pmt

Once a time trace of photoelectrons is obtained, the PMT is simulated as follows. For each photoelectron, the measured single photoelectron pulse shape is scaled by a random draw from the measured charge distribution (see Fig. 4(a)). The resulting scaled pulses are linearly added to a base current time distribution. This procedure makes two assumptions. The first is that the shape of the pulse at the base of the PMT does not depend on charge. The second is that the response of the PMT is linear. Post-PMT signal amplification in the upgraded electronics [8] has been set such that the limit of the dynamic range is reached prior to PMT departure from non-linearity.

Figure 3: Schematic depiction of single particle scenario. Photons produced within a scintillator bar may travel to the PMT in either direction along the fiber. Depending on the direction, photons are attenuated to different degrees. Additional losses are observed for particles crossing near the edges of the scintillator bars.

### Electronics

The procedure for simulating the post-PMT electronics is as follows. The current at the base of the PMT is convolved with the transfer function measured for the 40 MHz unified board [9] scaled to accommodate for the higher frequency of the 120 MHz upgraded unified board (see Figure 4(b)). Given the similar designs of the standard and upgraded front ends, it is assumed that this scaling yields a reasonable estimate for the transfer function, the form of which should fall well within the variance expected between boards. Nonetheless, a direct measurement of the transfer function will be considered once the exact production design of the upgraded unified board is confirmed. The result of the convolution is then scaled with a parameter analogous to gain and sampled at 120 MHz to obtain ADC traces. The parameter analogous to gain is tuned such that the mean charge (in ADC) of a vertical muon passing through any point of the scintillator surface equals the charge measured by deployed engineering array prototypes as determined via a vertical equivalent muon calibration detailed in [10].

## 3 Offline upgrade

Auger's Offline software framework has served as a simulation and reconstruction backbone for the Collaboration for over a decade, and has been adopted or used in some manner by a handful of other collaborations. In order to house the scintillator simulations described in this proceeding as well as the related storage, access, and processing needs of all the AugerPrime hardware, a number of upgrades to and augmentations of the software's framework have been performed. Greater flexibility in the detector description (see Figure 7) including the ability to group different types of hardware unique to individual stations at different points in time has been implemented. The corresponding machinery in updating the detector between events has also been upgraded. In this process, heavy focus has been maintained on keeping interfaces with users and module developers simple in order to keep the entry level skill necessary for programming the physics modules relatively low and reduce errors as a result.

Figure 4: (a) Simulated number of photoelectrons alongside scaled muon telescope measurements and fit of the attenuation model \(f_{\text{att}}\). (b) Fit to photoelectron production time distribution.

## 4 Conclusions

Simulations of the AugerPrime surface scintillator detector have been implemented within Auger's \(\overline{\mathrm{Offline}}\) software framework. At the core of these simulations lies the use of models and parameterizations derived from real prototype detector measurements where possible and the use of the latest field-standard software, Geant 4.10, where measurements are impossible or unavailable. The simulations have been tuned to the latest data from the AugerPrime engineering array, and promise to aid in both a detailed understanding of the upgraded surface detector as well as interpretation of future measurements of the observatory as the upgrade moves into the deployment phase. The \(\overline{\mathrm{Offline}}\) software has also been modified and augmented with the classes and machinery necessary to accommodate the data of the new hardware with the enhanced flexibility required by

Figure 5: (a) Pulse shape and charge distribution (inset) for properly amplified photoelectrons as measured using the the muon telescope setup. (b) Transfer function measured for Auger’s 40 MHz electronics along with scaled version used for the 120 MHz simulations up to the present.

Figure 6: Sample simulated current at the base of the PMT and convolution with electronics transfer function.

a detector description for which both the existence and properties of hardware components vary between stations and in time.

## References

* [1] Pierre Auger Collaboration, Preliminary Design Report, arXiv:1604.03637.
* [2] S. Argiro, _et al._, Nucl. Instrum. Meth. A 580 (2007) 1485; arXiv:0707.1652.
* [3] S. Agostinelli _et al._, Nucl. Instrum. Meth. A 506 (2003) 250.
* [4] R. Smida, for the Pierre Auger Collaboration, PoS (ICRC2017) 390.
* [5] P. Billoir, Astropart. Phys. 30 (2008) 270.
* Wissenschaftliche Berichte (1998).
* [7] P. Doll _et al._, Nucl. Instrum. Meth. A, 488 (2002) 517.
* [8] T. Suomijarvi, for the Pierre Auger Collaboration, PoS (ICRC2017) 450.
* [9] The Pierre Auger Collaboration, Nucl. Instrum. Meth. A, 798 (2015) 172; arXiv:1502.01323.
* [10] X. Bertou _et al._, for the Pierre Auger Collaboration, Nucl. Instrum. Meth. A 568 (2006) 839.

Figure 7: Schematic depiction of detector description machinery in Offline (taken from [1]) including both logically motivated classes with user interfaces (left) and the manager structure (right). This machinery has been updated for greater flexibility in the grouping of hardware components and the time evolution of the hardware on the individual station level.